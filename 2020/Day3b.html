<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>AoC2020 - Day 3 B</title>

</head>
<style>
    body {
        font-family: "Courier New";
        background-color: #181818;
        color: #9f9f9f;
        scroll-direction: horizontal;
        white-space: nowrap;
    }

    #collisions {
        position: absolute;
        top: 0;
        right: 0;
        width: 300px;
        height: 50px;
        text-align: center;
        background-color: red;
        font-size: 3rem;
        color: black;
    }
</style>
<body>
<!--

Comment:
    Ok wth. He really has a way of making the someone feel the pain for not paying attention to indices.
Lessons:
    * Clear separation of logical/computation and view rendering makes everything easier to adapt to and move fast.
-->
<div id="collisions">

</div>
<script>
    class Base {
        constructor() {
        }

        print(row) {
            const newDiv = document.createElement('div');
            newDiv.innerText = row;
            document.body.appendChild(newDiv);
        }
    }

    class Row extends Base {
        constructor(rawRow) {
            super();
            this.rawRow = rawRow.trim();
            this.value = [];
            this.rowView = '';
            this.index;
            this.collision = false;
            this.extend();
        }

        extend() {
            this.value = this.value.concat(this.rawRow.split(''));
        }

        // Credit: https://stackoverflow.com/questions/2998784/how-to-output-numbers-with-leading-zeros-in-javascript
        pad(num, size) {
            num = num.toString();
            while (num.length < size) num = "0" + num;
            return num;
        }

        calculate(index, columnPosition) {
            this.index = index;
            while (this.value.length - 1 < columnPosition) {
                this.extend();
            }
            const viewOnly = this.value.slice();
            const intersect = viewOnly[columnPosition];
            if (columnPosition !== 0) {
                if (intersect === '#') {
                    this.collision = true;
                    viewOnly[columnPosition] = `X`;
                } else {
                    viewOnly[columnPosition] = `O`;
                }
            }
            this.rowView = `${this.pad(index, 3)} ${viewOnly.join('')} -> ${this.value[columnPosition]}/${viewOnly[columnPosition]} ${this.collision ? '[HIT]' : ''}`
        }

        visualize(debug = false) {
            if (debug) this.print(`${this.pad(this.index, 3)} ${this.value.join('')} -> RAWINPUT`);
            this.print(this.rowView);
        }
    }

    class Start extends Base {
        constructor(input, slope) {
            super();
            this.input = input;
            this.rows = [];
            this.slopeX = slope[0];
            this.slopeY = slope[1];
            this.ptrX = 0;
            this.ptrY = 0;
            this.input.forEach((appRow) => {
                const row = new Row(appRow);
                this.rows.push(row);
            });
        }

        increment() {
            this.ptrX += this.slopeX;
            this.ptrY += this.slopeY;
        }

        compute() {
            this.rows.forEach((row) => {
                row.calculate(this.ptrY, this.ptrX);
                this.increment();
            });
        }

        visualize(debug) {
            this.rows.forEach((row) => {
                row.visualize(debug);
            });
        }
    }

    const puzzleData = ['.#..............##....#.#.####.', '##..........#.....##...........', '.......#....##...........#.#...', '.........#.#...#..........#....', '.........#..#................##', '..#...#..#..#...........#......', '...................#...##..##..', '........#.....##...#.#.#...#...', '#..#.##......#.#..#..........#.', '......#.#...#.#...#........##.#', '.....#.####........#...........', '...###..#............#.........', '.....#.......##......#...#.....', '#......##......................', '......#..............#.........', '..##...#....###.##.............', '#...#..........#.#.........#...', '...........#........#...#......', '.....##.........#......#..#....', '#..............#....#.....#....', '.#......#....#...#............#', '.####..........##..#.#.........', '....#...#......................', '....................#....#.#...', '..........###.#...............#', '.#...........#...##............', '.#.#..#.....#...#....#.......#.', '.##........#..#....#...........', '.........#.....#......###......', '..............#..#.......#.....', '........#..#.#...........#..#..', '#.........#......#.....##.#.#..', '........#.#.#....#.............', '........#........#.#.##........', '#......#.#..........#..#.......', '..#....#...##......###..#..#...', '............#..#.#.........#...', '....#.#...........#..........##', '.......#.#.#..#......#...#.....', '..#.........##.#.........#...#.', '......#....#.#....#........#.#.', '.#....###....#..............#..', '.#....#.......#....#..#.....#..', '.....#.....#...................', '..#.....#......#......#........', '......##.##...#...#...#...#.##.', '##...#....#...#..#...#...#.....', '..#.....#...#...##.##...#......', '.....#.............##...#......', '.....................#.##..#...', '#...#....#....#........#.....#.', '..#...#.........#...#..#.....#.', '#.#......#...................#.', '..#...........##...............', '..#....#........#..#...........', '...........#...................', '.............###......#....#...', '...........#...#....#..#....#..', '.....##............#.#.......#.', '.....#..#....#...#....#........', '...............##........#.#...', '.........#...#.#....#.......#..', '#..#.......#.......#...#.......', '..#...........................#', '......#.......#..#......#......', '.#.......#..................##.', '..#.........#..#.##.#....#...##', '...#..#....#...#....#.#........', '.#...#........##..#..#.......#.', '.....#........#....#....#..#...', '............#...........#......', '..###.......#..#....#......#...', '.....#...#.......#..#..........', '..#........##.#....##..........', '#....#.............#..##......#', '....#.................##.......', '...#.......#........#....##.#.#', '##..##..#.....#.....#..........', '...#...............#....#..#...', '.#...##....#....#.....#....##..', '...#.....#......#......#.......', '#.....#.......##.....#..#....##', '.....#.#...##.#......##....#.#.', '..........#....#.#...#.........', '.#..##...#.....................', '...........##..#...#....#......', '...#......#........#.......#...', '.#......#..#........#.....#..#.', '.......#........##..#.##....#..', '.##..........#..#...#.....#....', '.....##...............#.#......', '..##.....#..#......#..##.#.#...', '....#......#.##...........#....', '#.#..#.......#......#.#........', '...#.#..#....#............#..#.', '...#..........###....#....#...#', '........##...#.......#..#....#.', '..#...#.....#..#........##.....', '...#..#.##.#.#.##..............', '.......#...#.........#.....#..#', '..#.....#.#..........#..#......', '......#..........#......#.....#', '.#...........#........#......##', '..##............#......#...#..#', '#..................#...........', '#....#..#.........#........#..#', '..#.#....###..#...#...##...##..', '...#....#..#.....#.............', '.#........##.##...#....#...#...', '.........#.......##.#.....##...', '#.#.....##...#........#...#...#', '.....#.#.##...#.....#.##..#....', '........#...##...#...#.#..#..#.', '.##....#.##...#.......#........', '...#..#................#..#....', '....#.......#......#...#.##....', '#......###..#...#......#.......', '..#...#...##...........##......', '.......#...#..##....##......#..', '....#.#.............#.#...##..#', '..........#........#...#......#', '............#.#.#....###.......', '#..#...#.#.####...#..#...#.....', '.##.......#.##...#.............', '#..#...........#.#.##.......#..', '...#..#.#...#...###..#.#..#.#..', '..#...#.....#..#....#....#.....', '.........##.......#............', '.........##.##......###........', '.............#.#....#..#.....#.', '...#....#.#.......#......##....', '............#..................', '....##...#..........#...#..#...', '#..#....#.....#.......#.##.#..#', '.....#.........##.............#', '#.....#.#...#............##..##', '..............#....#.....#.....', '.#....###..#.#.....###.#..#....', '.....#....##...#....#......#...', '..........#...#....#...........', '............#....#..#.........#', '..##.....#.#...#.......#...#...', '...#...#..#......##...#.....##.', '......#.##............##.#....#', '....#......#...##.....#.....###', '.#.###...............#...#.#...', '..#....................##...#..', '.......#.....##...........#....', '#.........#....#....#....#....#', '..#.#..##.#.#..................', '.....#.......#................#', '...........#.......#........#..', '#...#.........#.#.....#.....#..', '..........#..#...........#.....', '#..#.##..##..#.#.##.........#..', '#..#..#....##..#.........#.....', '#.#.......................#.#..', '.##......#.#...#......#....#...', '..#.#................#..##.....', '.......#..................#...#', '.....#.........##.#....#.......', '#..........#..#.#..........#..#', '..#..#.....#.........#...#.....', '..............#.....#..#...#.##', '...............................', '...#............##......#.....#', '.......#..#.............#.#....', '...........#..........#........', '...#.####..#......#...#....#...', '##......#.##.....#.............', '....#.........#...#...........#', '...#........#.......#.#..#.#.#.', '..#.......#.........#....#.....', '................#.#.#.##...#..#', '#.##...#...#..#.....#.....#..#.', '...............#...........#...', '.....##.#...............##...#.', '.#..##.##......................', '.......#.........#..#..#.......', '...#......#..................#.', '...#.#..#....#....#............', '...........#...#..#....##......', '.....#...#..#.#....#....#....#.', '.......#...#...#.#.#...........', '....#......#......#...##..#....', '##...#.#.....#..#.##...........', '#.#..#.....#..#................', '...#..#.#......#.#...........##', '##....#...#.....###..#...#....#', '...#.....#.#.#......##...#...#.', '............#.......#..........', '....#..........###.......#.....', '.................##..##....#...', '...........#........##..#......', '...#.#...#.....#........#...#..', '#...#.#......#.#...........#...', '..#..........#....#..........#.', '..#................#...........', '#...#.#....#.#.......#.........', '.#...........##..#....#....#..#', '.##........#.....#...#..#....#.', '......#......#...#.............', '.......#..#...#.##....#..#.#...', '.......#......#....#....#.#.#..', '..........##.....#....##.#.....', '.........##..#...#.....#..#....', '...#....#..........#..#...#..#.', '.......#.....##.#..#.....#...#.', '#...#......#......#...#........', '#..#....#.#......#......#......', '.......#.##....................', '...##...#.....#......##......#.', '.#...................###.......', '....#........###...#........#..', '...#............#.....#..#.....', '..................#......#....#', '..##......#..##..##......#.#...', '........##....##.......#...#...', '.#.#....#.....#.....#....#....#', '...##.#.............#....##....', '.........#.....#...#......#....', '..#.....#............#....##...', '..##.....#.....##.##...........', '#....#.#.......#..#......#.....', '##.......#.....#.....####....#.', '##...#.......#...#.....#.......', '#.....#..##.##...##..#.....#..#', '..........#......#..#.#........', '..##.#......#..............#...', '.#...#..........#.......#....#.', '..#....##...#...........#....#.', '..#.........#..#......#......#.', '.##....#......#.#.........#..##', '.......#...#....##............#', '.##.................#.#........', '...#.#...#..#..#.....#.#.......', '.#.#.......#...................', '..#..#.....#......#.....##..##.', '.#........#.##......#..........', '....##...#............#.#....#.', '.......#.#..#....##.#....#....#', '......####...#..#.....#........', '..........#..#.........#.#..#.#', '..........##.........#.##......', '.##..#.#.....#.....#....#......', '............#..#...............', '.....##.........#...#...##...##', '........#.##.#...#.....#....#.#', '#......##.#.##..........##.....', '#..#..#........#.........#..#..', '...............#.#..##.........', '.#.......##.#..#....#...#....##', '.#..##.....##......#....#...#.#', '........#...#.........#.....#.#', '...........#............#...#..', '................#...........#..', '..............##........#....#.', '..........#.....##.....#..#....', '#......#....###..#..#..........', '.....#.#.....##....#.#.......#.', '...#...#...............#.#.....', '.............#.......#.........', '.....#.....#..#......#.....#...', '.........#.................#.##', '.#.....#.##..#.................', '..#......#.......#.....#...#..#', '..#..#.#.#...#.......#.##......', '..........#..#.........#.......', '.#..........#...#....#..#...##.', '.#.#.#.###.....#...#.#.#.......', '....##............#............', '.#.#.............#..#......#.#.', '.#.#..........##..#.....#..#.#.', '...........#.##..#...#.#.....#.', '...........#..#....#...........', '..#................#.#...#....#', '...............##........##....', '....#.............#........#...', '...#......#.#.#........#.......', '#..............#..##.#..##.....', '.#.#.###................##.....', '.............#..#.........#....', '.......##..#............#...#..', '...#...#...........#.....#.....', '........#......#.#.#......#..#.', '#.##.......#......#..#..#.#....', '...#........#...........#...#..', '..#...........#.........#......', '.............#....#....#.......', '....#.........#........#......#', '..#............##..#.........#.', '.#...#...#..#...#........#..#..', '...#....##..............#......', '...........#...#....#.#.##..###', '..#....#......#.........#..#...', '.......#...#...................', '.#...#.#...................#...', '.#.....##.#.......#.#.#...##..#', '.....#..#.#.........#...#..##..', '.#..#.##.#......#......#.#...#.', '......#..#....##..#....##....##', '#...#......##........##........', '.#.........###................#', '.................#..###..#.#...', '..#.#........#..#........#...#.', '#.#....#....#..#...#.#......#..', '.#.#.............###.........#.', '.....#...............##...#...#', '..............#...#........#..#', '...................#..#.......#', '#......................#.....#.', '...#.........#..##...#...#.##..', '.....#..........#.........#....', '.....#...#............#..#.....', '.............#............#....', '...#.........#.................', '#...........#.#...............#', '.....#...#.....#..#.##.......##', '...#....#.#...........#........', '.........................#.#...', '.#..#...........#.#........#...', '.............#.#.....#..#....#.', '.....#...#.###...#..#........#.'];
    const puzzleExample = ['..##.........##.........##.........##.........##.........##.......', '#..O#...#..#...#...#..#...#...#..#...#...#..#...#...#..#...#...#..', '.#....X..#..#....#..#..#....#..#..#....#..#..#....#..#..#....#..#.', '..#.#...#O#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#', '.#...##..#..X...##..#..#...##..#..#...##..#..#...##..#..#...##..#.', '..#.##.......#.X#.......#.##.......#.##.......#.##.......#.##.....', '.#.#.#....#.#.#.#.O..#.#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#', '.#........#.#........X.#........#.#........#.#........#.#........#', '#.##...#...#.##...#...#.X#...#...#.##...#...#.##...#...#.##...#...', '#...##....##...##....##...#X....##...##....##...##....##...##....#', '.#..#...#.#.#..#...#.#.#..#...X.#.#..#...#.#.#..#...#.#.#..#...#.#'];
    const slopes = [
        [1, 1],
        [3, 1],
        [5, 1],
        [7, 1],
        [1, 2],
    ];
    let results = [];
    let app = new Start(puzzleExample, slopes[1]);
    app.compute();
    app.visualize(1);
    console.log(app);
    document.getElementById('collisions').innerText = app.rows.filter((row) => row.collision).length;

    slopes.forEach((slope, index) => {
        let app = new Start(puzzleExample, slope);
        app.compute();
        let totalCollisions = app.rows.filter((row) => row.collision).length;
        app.print(`For slope index ${index} (${slope}) the total collisions = ${totalCollisions}`);
        results.push(totalCollisions);
        app.visualize(1);
    });
    const reduction  =  results.reduce((a, b) => a * b, 1);
    document.getElementById('collisions').innerText = reduction;

</script>
</body>
</html>
